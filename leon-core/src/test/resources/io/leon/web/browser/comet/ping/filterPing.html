<html>
<head>
    <title>Comet Ping test</title>
    <script src="/leon/leon.js?loadAngular=false" type="text/javascript"></script>
    <script type="text/javascript">
	    $(function() {
		    var do50 = function(callback) {
			    var count = 0;
			    (function _do50() {
				    if (getLeon().comet.isCometActive()) {
	                    callback();
	                    count = count + 1;
	                }
	                if (count < 50) {
	                    setTimeout(function() { _do50() }, 100);
	                }
	            })();
	        }

	        getLeon().filterTopic("filterPing", "key1", "value1");
	        getLeon().filterTopic("filterPing", "key2", "value2");

	        getLeon().subscribeTopic("filterPing", function(data) {
                $("#status_" + data.key).text(data.value);
	        });

		    $("#start").click(function() {
	            getLeon().filterTopic("filterPing", "key3", "value3");
	            getLeon().filterTopic("filterPing", "key4", "value4");
	            getLeon().filterTopic("filterPing", "key5", "value5");

			    do50(function() {
		            getLeon().service("/pingService", "filterPing").call("key1", "value1");
		            getLeon().service("/pingService", "filterPing").call("key2", "value2");
		            getLeon().service("/pingService", "filterPing").call("key3", "valueXXXXXXX");
		            getLeon().service("/pingService", "filterPing").call("key4", "value4");
		            getLeon().service("/pingService", "filterPing").call("key5", "valueXXXXXXX");
		        });
		    });

	        $("#status").text("init");
	    });
    </script>
</head>

<body>
<div>
    <a id="start" href="#">start</a>
    <div id="status"></div>
    <div id="status_key1">false</div>
    <div id="status_key2">false</div>
    <div id="status_key3">false</div>
    <div id="status_key4">false</div>
    <div id="status_key5">false</div>
</div>
</body>
</html>
