<html>
<head>
    <title>Comet Ping test</title>
    <script src="/leon/leon.js?loadAngular=false" type="text/javascript"></script>
    <script type="text/javascript">
	    $(function() {
	        getLeon().subscribeTopic("numberPing", function(data) {
                $("#status" + data).text("done");
	        });

	        var do50 = function(callback) {
			    var count = 0;
			    (function _do50() {
				    if (getLeon().comet.isCometActive()) {
	                    callback();
	                    count = count + 1;
	                }
	                if (count < 50) {
	                    setTimeout(function() { _do50() }, 100);
	                }
	            })();
	        }

		    $("#sendPing").click(function() {
		        do50(function() { getLeon().service("/pingService", "numberPing").call(1) });
		        do50(function() { getLeon().service("/pingService", "numberPing").call(2) });
		        do50(function() { getLeon().service("/pingService", "numberPing").call(3) });
		        do50(function() { getLeon().service("/pingService", "numberPing").call(4) });
		        do50(function() { getLeon().service("/pingService", "numberPing").call(5) });
            });

	        $("#init").text("done");
	    });
    </script>
</head>

<body>
<div>
    <h1>Comet Ping example</h1>
    <hr />

    <a id="sendPing" href="#">Send ping to server</a>
    <br/>

    <h2>Status</h2>
    <div id="init"></div>

    <div id="status1"></div>
    <div id="status2"></div>
    <div id="status3"></div>
    <div id="status4"></div>
    <div id="status5"></div>
</div>
</body>
</html>
